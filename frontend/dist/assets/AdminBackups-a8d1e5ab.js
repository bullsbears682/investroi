import{j as e}from"./index-05d7ddf5.js";import{r as l}from"./vendor-fb33f09a.js";import{A as H}from"./AdminMenu-ca49e414.js";import{a as V}from"./router-c6dabb7d.js";import{a9 as W,ab as k,b as X,D as y,ag as x,w as q,ad as S,X as G,a as Q}from"./ui-99c97883.js";const ae=()=>{const T=V(),[i,B]=l.useState([]),[a,D]=l.useState(null),[F,C]=l.useState(!1),[E,j]=l.useState(!1),[J,g]=l.useState(!1),[n,w]=l.useState(null),[d,f]=l.useState(null),[N,z]=l.useState(!1),[I,A]=l.useState(!1);l.useEffect(()=>{m();const s=r=>{r.key==="databaseBackups"&&m()},t=()=>m();return window.addEventListener("storage",s),window.addEventListener("backupsUpdated",t),()=>{window.removeEventListener("storage",s),window.removeEventListener("backupsUpdated",t)}},[]);const U=()=>{try{const s=`backup-${Date.now()}`,t={users:JSON.parse(localStorage.getItem("registered_users")||"[]"),contacts:JSON.parse(localStorage.getItem("contact_submissions")||"[]"),chatMessages:JSON.parse(localStorage.getItem("chatMessages")||"[]"),otherData:{}},r=JSON.stringify(t),h=r.length,p=r.length*1.2,c=Math.round((1-h/p)*100),b=btoa(r);let u=0;for(let v=0;v<b.length;v++)u+=b.charCodeAt(v);u=u%1e6;const _={timestamp:Date.now(),backupId:s,data:b,metadata:{totalRecords:t.users.length+t.contacts.length+t.chatMessages.length,backupSize:`${(h/1024).toFixed(1)} KB`,compressionRatio:`${c}%`,encryptionStatus:"Encrypted",integrityChecksum:u.toString().padStart(6,"0"),originalSize:`${(p/1024).toFixed(1)} KB`,compressedSize:`${(h/1024).toFixed(1)} KB`,encryptedSize:`${(b.length/1024).toFixed(1)} KB`},checksum:u.toString().padStart(6,"0")},M=JSON.parse(localStorage.getItem("databaseBackups")||"[]");M.unshift(_),localStorage.setItem("databaseBackups",JSON.stringify(M.slice(0,10))),window.dispatchEvent(new CustomEvent("backupsUpdated")),alert("Backup created successfully."),m()}catch(s){console.error("Create backup failed:",s),alert("Failed to create backup.")}},m=()=>{try{const s=localStorage.getItem("databaseBackups");s&&B(JSON.parse(s))}catch(s){console.error("Failed to load backups:",s)}},R=async s=>{f(s),g(!0)},$=async()=>{if(d){z(!0);try{await new Promise(t=>setTimeout(t,2e3));const s=JSON.parse(d.data);s.users&&localStorage.setItem("registered_users",JSON.stringify(s.users)),s.contacts&&localStorage.setItem("contact_submissions",JSON.stringify(s.contacts)),s.chatMessages&&localStorage.setItem("chatMessages",JSON.stringify(s.chatMessages)),s.otherData&&Object.keys(s.otherData).forEach(t=>{localStorage.setItem(t,JSON.stringify(s.otherData[t]))}),alert("Backup restored successfully! The application data has been updated."),window.location.reload()}catch(s){console.error("Failed to restore backup:",s),alert("Failed to restore backup. Please try again.")}finally{z(!1),g(!1),f(null)}}},O=s=>{w(s),j(!0)},P=()=>{if(n)try{const s=i.filter(t=>t.backupId!==n.backupId);localStorage.setItem("databaseBackups",JSON.stringify(s)),B(s),alert("Backup deleted successfully!")}catch(s){console.error("Failed to delete backup:",s),alert("Failed to delete backup. Please try again.")}finally{j(!1),w(null)}},L=s=>{try{const t={backupInfo:{backupId:s.backupId,timestamp:new Date(s.timestamp).toISOString(),generatedBy:"Admin Dashboard",version:"1.0"},metadata:s.metadata,checksum:s.checksum,data:s.data},r=JSON.stringify(t,null,2),h=new Blob([r],{type:"application/json"}),p=window.URL.createObjectURL(h),c=document.createElement("a");c.href=p,c.download=`backup-${s.backupId}-${new Date(s.timestamp).toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(p),alert("Backup downloaded successfully!")}catch(t){console.error("Failed to download backup:",t),alert("Failed to download backup. Please try again.")}},K=s=>{D(s),C(!0)},o=()=>{D(null),C(!1),j(!1),g(!1),w(null),f(null)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:[e.jsx(H,{isOpen:I,onToggle:()=>A(!I)}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl border-b border-white/20 lg:ml-64",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4",children:e.jsxs("button",{onClick:()=>T("/admin"),className:"flex items-center space-x-1 sm:space-x-2 text-white/80 hover:text-white transition-colors p-2 sm:p-0",children:[e.jsx(W,{size:18,className:"sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Dashboard"}),e.jsx("span",{className:"sm:hidden",children:"Back"})]})}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsxs("h1",{className:"text-lg sm:text-2xl font-bold text-white flex items-center space-x-2",children:[e.jsx(k,{size:24,className:"sm:w-7 sm:h-7"}),e.jsx("span",{className:"hidden sm:inline",children:"Backup Management"}),e.jsx("span",{className:"sm:hidden",children:"Backups"})]}),e.jsx("button",{onClick:U,className:"px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white text-sm",title:"Create a new backup",children:"Create Backup"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8 lg:ml-64",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs sm:text-sm font-medium",children:"Total Backups"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-white",children:i.length})]}),e.jsx("div",{className:"bg-blue-500/20 p-2 sm:p-3 rounded-lg sm:rounded-xl",children:e.jsx(k,{className:"text-blue-400 sm:w-6 sm:h-6",size:20})})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs sm:text-sm font-medium",children:"Latest Backup"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-white",children:i.length>0?new Date(i[i.length-1].timestamp).toLocaleDateString():"No backups"})]}),e.jsx("div",{className:"bg-green-500/20 p-2 sm:p-3 rounded-lg sm:rounded-xl",children:e.jsx(X,{className:"text-green-400 sm:w-6 sm:h-6",size:20})})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20 sm:col-span-2 lg:col-span-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs sm:text-sm font-medium",children:"Storage Used"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-white",children:i.length>0?`${(i.reduce((s,t)=>s+parseFloat(t.metadata.compressedSize.replace(" KB","")),0)/1024).toFixed(2)} MB`:"0 MB"})]}),e.jsx("div",{className:"bg-purple-500/20 p-2 sm:p-3 rounded-lg sm:rounded-xl",children:e.jsx(y,{className:"text-purple-400 sm:w-6 sm:h-6",size:20})})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-xl sm:rounded-2xl p-4 sm:p-6 border border-white/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-4 sm:mb-6 space-y-3 sm:space-y-0",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-white",children:"Backup History"}),e.jsxs("button",{onClick:m,className:"flex items-center justify-center space-x-2 px-3 sm:px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors w-full sm:w-auto",children:[e.jsx(x,{size:16}),e.jsx("span",{children:"Refresh"})]})]}),i.length===0?e.jsxs("div",{className:"text-center py-8 sm:py-12",children:[e.jsx(k,{className:"mx-auto text-white/40 sm:w-12 sm:h-12",size:40}),e.jsx("p",{className:"text-white/60 mt-4 text-base sm:text-lg",children:"No backups found"}),e.jsx("p",{className:"text-white/40 mt-2 text-sm sm:text-base",children:"Create your first backup from the main dashboard"})]}):e.jsx("div",{className:"space-y-3 sm:space-y-4",children:i.map(s=>e.jsx("div",{className:"bg-white/5 rounded-lg sm:rounded-xl p-3 sm:p-4 border border-white/10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between space-y-3 sm:space-y-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-3 mb-2",children:[e.jsx("h4",{className:"text-white font-medium text-sm sm:text-base truncate",children:s.backupId}),e.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-400 rounded-full text-xs font-medium w-fit",children:"Successful"})]}),e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Date:"}),e.jsx("p",{className:"text-white",children:new Date(s.timestamp).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Time:"}),e.jsx("p",{className:"text-white",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Size:"}),e.jsx("p",{className:"text-white",children:s.metadata.compressedSize})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Records:"}),e.jsx("p",{className:"text-white",children:s.metadata.totalRecords})]})]}),e.jsxs("div",{className:"text-xs text-white/60",children:[e.jsxs("span",{children:["Compression: ",s.metadata.compressionRatio," | "]}),e.jsxs("span",{children:["Encryption: ",s.metadata.encryptionStatus]})]})]}),e.jsxs("div",{className:"hidden sm:grid sm:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Date:"}),e.jsx("p",{className:"text-white",children:new Date(s.timestamp).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Time:"}),e.jsx("p",{className:"text-white",children:new Date(s.timestamp).toLocaleTimeString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Size:"}),e.jsx("p",{className:"text-white",children:s.metadata.compressedSize})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60",children:"Records:"}),e.jsx("p",{className:"text-white",children:s.metadata.totalRecords})]})]}),e.jsxs("div",{className:"hidden sm:block mt-3 text-xs text-white/60",children:[e.jsxs("span",{children:["Compression: ",s.metadata.compressionRatio," | "]}),e.jsxs("span",{children:["Encryption: ",s.metadata.encryptionStatus," | "]}),e.jsxs("span",{children:["Checksum: ",s.metadata.integrityChecksum.substring(0,8),"..."]})]})]}),e.jsxs("div",{className:"flex justify-center sm:justify-end space-x-2 sm:ml-4",children:[e.jsx("button",{onClick:()=>K(s),className:"p-2 text-blue-400 hover:text-blue-300 transition-colors rounded-lg hover:bg-white/10",title:"View Details",children:e.jsx(q,{size:16})}),e.jsx("button",{onClick:()=>L(s),className:"p-2 text-blue-400 hover:text-blue-300 transition-colors rounded-lg hover:bg-white/10",title:"Download Backup",children:e.jsx(y,{size:16})}),e.jsx("button",{onClick:()=>R(s),className:"p-2 text-green-400 hover:text-green-300 transition-colors rounded-lg hover:bg-white/10",title:"Restore Backup",children:e.jsx(x,{size:16})}),e.jsx("button",{onClick:()=>O(s),className:"p-2 text-red-400 hover:text-red-300 transition-colors rounded-lg hover:bg-white/10",title:"Delete Backup",children:e.jsx(S,{size:16})})]})]})},s.backupId))})]}),F&&a&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:o,children:e.jsxs("div",{className:"relative bg-gradient-to-br from-white/15 to-white/5 backdrop-blur-xl rounded-3xl p-6 border border-white/30 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/10 via-purple-500/5 to-indigo-500/10 rounded-3xl"}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-32 bg-blue-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-24 h-24 bg-purple-500/20 rounded-full blur-2xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-white",children:"Backup Details"}),e.jsx("button",{onClick:o,className:"text-white/60 hover:text-white p-1",children:e.jsx(G,{size:20})})]}),e.jsxs("div",{className:"space-y-4 text-white/80",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Backup ID:"}),e.jsx("p",{className:"text-white text-sm sm:text-base break-all",children:a.backupId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Date:"}),e.jsx("p",{className:"text-white text-sm sm:text-base",children:new Date(a.timestamp).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Original Size:"}),e.jsx("p",{className:"text-white text-sm sm:text-base",children:a.metadata.originalSize})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Compressed Size:"}),e.jsx("p",{className:"text-white text-sm sm:text-base",children:a.metadata.compressedSize})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Compression Ratio:"}),e.jsx("p",{className:"text-white text-sm sm:text-base",children:a.metadata.compressionRatio})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Total Records:"}),e.jsx("p",{className:"text-white text-sm sm:text-base",children:a.metadata.totalRecords})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Integrity Checksum:"}),e.jsx("p",{className:"text-white font-mono text-xs sm:text-sm break-all",children:a.metadata.integrityChecksum})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 pt-4",children:[e.jsxs("button",{onClick:()=>L(a),className:"flex items-center justify-center space-x-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(y,{size:16}),e.jsx("span",{children:"Download"})]}),e.jsxs("button",{onClick:()=>R(a),className:"flex items-center justify-center space-x-2 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(x,{size:16}),e.jsx("span",{children:"Restore"})]}),e.jsxs("button",{onClick:()=>O(a),className:"flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(S,{size:16}),e.jsx("span",{children:"Delete"})]})]})]})]})]})}),E&&n&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:o,children:e.jsxs("div",{className:"relative bg-gradient-to-br from-white/15 to-white/5 backdrop-blur-xl rounded-3xl p-6 border border-white/30 w-full max-w-md shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-red-500/10 via-purple-500/5 to-blue-500/10 rounded-3xl"}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-32 bg-red-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-24 h-24 bg-blue-500/20 rounded-full blur-2xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-red-500/20 p-2 rounded-lg",children:e.jsx(Q,{className:"text-red-400",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-white",children:"Delete Backup"}),e.jsx("p",{className:"text-white/60 text-sm",children:"This action cannot be undone."})]})]}),e.jsxs("div",{className:"text-white mb-6",children:[e.jsx("p",{children:"Are you sure you want to delete this backup?"}),e.jsxs("p",{className:"text-white/60 mt-2",children:[e.jsx("strong",{children:"Backup ID:"})," ",n.backupId,e.jsx("br",{}),e.jsx("strong",{children:"Date:"})," ",new Date(n.timestamp).toLocaleString(),e.jsx("br",{}),e.jsx("strong",{children:"Size:"})," ",n.metadata.compressedSize]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsxs("button",{onClick:P,className:"flex items-center justify-center space-x-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:[e.jsx(S,{size:16}),e.jsx("span",{children:"Delete Backup"})]}),e.jsx("button",{onClick:o,className:"flex items-center justify-center space-x-2 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:e.jsx("span",{children:"Cancel"})})]})]})]})}),J&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4",onClick:o,children:e.jsxs("div",{className:"relative bg-gradient-to-br from-white/15 to-white/5 backdrop-blur-xl rounded-3xl p-6 border border-white/30 w-full max-w-md shadow-2xl",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-green-500/10 via-purple-500/5 to-blue-500/10 rounded-3xl"}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-32 bg-green-500/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-24 h-24 bg-purple-500/20 rounded-full blur-2xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-green-500/20 p-2 rounded-lg",children:e.jsx(x,{className:"text-green-400",size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-white",children:"Restore Backup"}),e.jsx("p",{className:"text-white/60 text-sm",children:"This will overwrite current data."})]})]}),e.jsxs("div",{className:"text-white mb-6",children:[e.jsx("p",{children:"Are you sure you want to restore this backup?"}),e.jsxs("p",{className:"text-white/60 mt-2",children:[e.jsx("strong",{children:"Backup ID:"})," ",d.backupId,e.jsx("br",{}),e.jsx("strong",{children:"Date:"})," ",new Date(d.timestamp).toLocaleString(),e.jsx("br",{}),e.jsx("strong",{children:"Records:"})," ",d.metadata.totalRecords]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg",children:e.jsxs("p",{className:"text-yellow-400 text-sm",children:[e.jsx("strong",{children:"Warning:"})," This will replace all current application data with the backup data."]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:$,disabled:N,className:"flex items-center justify-center space-x-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-500 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:N?e.jsxs(e.Fragment,{children:[e.jsx(x,{size:16,className:"animate-spin"}),e.jsx("span",{children:"Restoring..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(x,{size:16}),e.jsx("span",{children:"Restore Backup"})]})}),e.jsx("button",{onClick:o,disabled:N,className:"flex items-center justify-center space-x-2 bg-white/10 hover:bg-white/20 disabled:bg-gray-500 text-white px-4 py-2 rounded-lg transition-colors text-sm",children:e.jsx("span",{children:"Cancel"})})]})]})]})})]})]})};export{ae as default};
//# sourceMappingURL=AdminBackups-a8d1e5ab.js.map
