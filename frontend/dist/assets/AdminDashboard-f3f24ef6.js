import{j as e,U as z,A as S,o as F,M as I,m as k,q}from"./index-52440fcd.js";import{r as l}from"./vendor-fb33f09a.js";import{L as m}from"./router-c6dabb7d.js";import{A as Q}from"./AdminMenu-381e9601.js";import{c as M}from"./contactStorage-14a689f3.js";import"./ui-027738c2.js";const J=x=>{if(!x)return"â€”";const p=Date.now()-x,r=Math.floor(p/1e3);if(r<5)return"just now";if(r<60)return`${r}s ago`;const o=Math.floor(r/60);if(o<60)return`${o}m ago`;const i=Math.floor(o/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`},W=()=>{const[x,p]=l.useState(!1),[r,o]=l.useState(!0),[i,C]=l.useState({totalUsers:0,activeUsers:0,totalCalculations:0,totalExports:0,contacts:0,openChats:0}),[u,L]=l.useState([]),[A,$]=l.useState([]),[j,_]=l.useState(""),[R,v]=l.useState(null),[d,w]=l.useState(!1),N=()=>{var t,s;try{const n=k.getAllUsers(),c=k.getActiveUsers(),a=n.reduce((b,y)=>b+(y.totalCalculations||0),0),h=n.reduce((b,y)=>b+(y.totalExports||0),0),O=M.getSubmissions(),T=(((s=(t=q).getAllSessions)==null?void 0:s.call(t))||[]).filter(b=>b.status!=="closed").length;C({totalUsers:n.length,activeUsers:c.length,totalCalculations:a,totalExports:h,contacts:O.length,openChats:T})}catch(n){console.error("Failed to load admin summary:",n)}},f=()=>{try{$(M.getRecentSubmissions(5))}catch(t){console.error("Failed to load recent messages",t)}},E=()=>{try{const t=[],s=Date.now();k.getAllUsers().filter(a=>new Date(a.registrationDate).getTime()>s-7*24*60*60*1e3).slice(0,5).forEach(a=>t.push({id:`reg-${a.id}`,type:"registration",description:`New user: ${a.name}`,timestamp:new Date(a.registrationDate).getTime(),color:"bg-green-400"})),JSON.parse(localStorage.getItem("chatMessages")||"[]").filter(a=>new Date(a.timestamp).getTime()>s-24*60*60*1e3).slice(0,5).forEach((a,h)=>t.push({id:`chat-${a.id||h}`,type:"chat",description:`Chat from ${a.userName||"User"}`,timestamp:new Date(a.timestamp).getTime(),color:"bg-yellow-400"})),t.sort((a,h)=>h.timestamp-a.timestamp),L(t.slice(0,12))}catch(t){console.error("Failed to load recent activity:",t)}},g=()=>{o(!0),N(),E(),f(),v(Date.now()),w(localStorage.getItem("maintenance_mode")==="true"),setTimeout(()=>o(!1),250)};l.useEffect(()=>{g();const t=c=>{(c.key==="registered_users"||c.key==="contact_submissions"||c.key==="chatMessages"||c.key==="maintenance_mode")&&(N(),E(),f(),w(localStorage.getItem("maintenance_mode")==="true"),v(Date.now()))},s=()=>{N(),f(),v(Date.now())};window.addEventListener("storage",t),window.addEventListener("contact_submissions_updated",s);const n=()=>w(localStorage.getItem("maintenance_mode")==="true");return window.addEventListener("maintenanceChanged",n),()=>{window.removeEventListener("storage",t),window.removeEventListener("contact_submissions_updated",s),window.removeEventListener("maintenanceChanged",n)}},[]);const U=l.useMemo(()=>{const t=j.trim().toLowerCase();return t?u.filter(s=>s.description.toLowerCase().includes(t)):u},[u,j]),D=()=>{const t=!d;localStorage.setItem("maintenance_mode",String(t)),w(t),window.dispatchEvent(new Event("maintenanceChanged"))};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-950 via-indigo-950 to-slate-900",children:[e.jsx(Q,{isOpen:x,onToggle:()=>p(!x)}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl border-b border-white/20 lg:ml-64",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 sm:h-16",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{className:"sm:hidden inline-flex items-center px-3 py-1.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm",onClick:()=>p(!0),"aria-label":"Open admin menu",children:"Menu"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Admin Dashboard"}),e.jsx("p",{className:"hidden sm:block text-white/60 text-sm",children:"Overview, insights and admin tools"})]}),e.jsxs("div",{className:"hidden sm:flex gap-2",children:[e.jsx(m,{to:"/admin/analytics",className:"px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white text-sm",children:"Analytics"}),e.jsx(m,{to:"/admin/data",className:"px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white text-sm",children:"Users"}),e.jsx(m,{to:"/admin/system",className:"px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white text-sm",children:"System"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-6 sm:py-8 lg:ml-64",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"text-white/60 text-sm",children:["Last updated ",e.jsx("span",{className:"text-white",children:J(R)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:D,className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm border transition-colors ${d?"bg-yellow-500/20 border-yellow-400/40 text-yellow-200 hover:bg-yellow-500/30":"bg-white/10 border-white/20 text-white hover:bg-white/20"}`,"aria-label":"Toggle maintenance mode",children:d?"Disable Maintenance":"Enable Maintenance"}),e.jsx("button",{onClick:g,className:"inline-flex items-center gap-2 px-3 py-1.5 bg-white/10 hover:bg-white/20 border border-white/20 rounded-lg text-white text-sm","aria-label":"Refresh dashboard",children:"Refresh"})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8",children:r?Array.from({length:4}).map((t,s)=>e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-6 border border-white/20 animate-pulse",children:[e.jsx("div",{className:"h-4 w-24 bg-white/20 rounded mb-3"}),e.jsx("div",{className:"h-8 w-20 bg-white/30 rounded"})]},s)):[{label:"Total Users",value:i.totalUsers,Icon:z,color:"text-blue-400"},{label:"Active Users",value:i.activeUsers,Icon:S,color:"text-green-400"},{label:"Calculations",value:i.totalCalculations,Icon:S,color:"text-purple-400"},{label:"Exports",value:i.totalExports,Icon:F,color:"text-yellow-400"}].map((t,s)=>e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-6 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-sm",children:t.label}),e.jsx("p",{className:"text-3xl font-bold text-white",children:t.value})]}),e.jsx("div",{className:"p-3 bg-white/10 rounded-xl",children:e.jsx(t.Icon,{className:`${t.color}`,size:22})})]})},s))}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8 sm:mb-10",children:r?Array.from({length:4}).map((t,s)=>e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-5 border border-white/20 animate-pulse",children:[e.jsx("div",{className:"h-3 w-20 bg-white/20 rounded mb-2"}),e.jsx("div",{className:"h-6 w-16 bg-white/30 rounded"})]},s)):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-5 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs",children:"Contacts"}),e.jsx("p",{className:"text-xl font-semibold text-white",children:i.contacts})]}),e.jsx("div",{className:"p-2.5 bg-white/10 rounded-xl",children:e.jsx(I,{className:"text-pink-300",size:18})})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-5 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs",children:"Open Chats"}),e.jsx("p",{className:"text-xl font-semibold text-white",children:i.openChats})]}),e.jsx("div",{className:"p-2.5 bg-white/10 rounded-xl",children:e.jsx(I,{className:"text-emerald-300",size:18})})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-5 border border-white/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/60 text-xs",children:"Maintenance"}),e.jsx("p",{className:"text-xl font-semibold text-white",children:d?"Enabled":"Disabled"})]}),e.jsx("div",{className:"p-2.5 bg-white/10 rounded-xl",children:e.jsx(S,{className:"text-yellow-300",size:18})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-6 border border-white/20",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 mb-3 sm:mb-4",children:[e.jsx("h2",{className:"text-white font-semibold",children:"Recent Activity"}),e.jsx(m,{to:"/admin/analytics",className:"text-white/70 hover:text-white text-sm underline",children:"View analytics"})]}),e.jsx("div",{className:"mb-3 sm:mb-4",children:e.jsx("input",{value:j,onChange:t=>_(t.target.value),placeholder:"Search activity...","aria-label":"Search recent activity",className:"w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-indigo-400/40"})}),e.jsxs("div",{className:"space-y-3",children:[r&&e.jsx(e.Fragment,{children:Array.from({length:6}).map((t,s)=>e.jsx("div",{className:"h-10 bg-white/10 rounded-lg animate-pulse"},s))}),!r&&U.length===0&&e.jsx("p",{className:"text-white/60 text-sm",children:"No activity matches your search."}),!r&&U.map(t=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:`w-2.5 h-2.5 ${t.color} rounded-full`}),e.jsx("span",{className:"text-white/80 text-sm truncate",children:t.description})]}),e.jsx("span",{className:"text-white/50 text-xs",children:new Date(t.timestamp).toLocaleString()})]},t.id))]})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-6 border border-white/20",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"System Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-white/80",children:[e.jsx("span",{children:"Network"}),e.jsx("span",{className:"text-white",children:(()=>{try{const t=navigator.connection,s=(t==null?void 0:t.effectiveType)||"unknown",n=t!=null&&t.downlink?`${t.downlink}Mbps`:"n/a";return`${s} (${n})`}catch{return"unknown"}})()})]}),e.jsxs("div",{className:"flex items-center justify-between text-white/80",children:[e.jsx("span",{children:"Memory"}),e.jsx("span",{className:"text-white",children:(()=>{var t;try{const s=(t=window.performance)==null?void 0:t.memory;return s?`${Math.round(s.usedJSHeapSize/1024/1024)}MB`:"n/a"}catch{return"n/a"}})()})]}),e.jsxs("div",{className:"flex items-center justify-between text-white/80",children:[e.jsx("span",{children:"Maintenance"}),e.jsx("span",{className:"text-white",children:d?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"flex items-center justify-between text-white/80",children:[e.jsx("span",{children:"Open Chats"}),e.jsx("span",{className:"text-white",children:i.openChats})]})]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-6 border border-white/20",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Recent Messages"}),e.jsxs("div",{className:"space-y-2",children:[A.length===0&&e.jsx("p",{className:"text-white/60 text-sm",children:"No recent messages"}),A.map(t=>e.jsxs("div",{className:"flex items-start justify-between gap-3 p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-white text-sm truncate",children:[t.name," â€¢ ",e.jsx("span",{className:"text-white/70",children:t.email})]}),e.jsx("div",{className:"text-white/80 text-sm truncate",children:t.subject}),e.jsx("div",{className:"text-white/50 text-xs",children:new Date(t.timestamp).toLocaleString()})]}),t.status!=="read"&&e.jsx("button",{onClick:()=>{M.updateSubmissionStatus(t.id,"read"),g()},className:"text-xs px-2 py-1 rounded bg-white/10 hover:bg-white/20 border border-white/20 text-white",children:"Mark read"})]},t.id))]})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-4 sm:p-6 border border-white/20",children:[e.jsx("h3",{className:"text-white font-semibold mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(m,{to:"/admin/data",className:"px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm text-center",children:"Manage Users"}),e.jsx(m,{to:"/admin/chat",className:"px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm text-center",children:"Open Chat"}),e.jsxs("button",{onClick:D,className:"px-3 py-2 bg-yellow-500/20 hover:bg-yellow-500/30 rounded-lg text-yellow-200 text-sm text-center border border-yellow-400/40",children:[d?"Disable":"Enable"," Maintenance"]}),e.jsx("button",{onClick:g,className:"px-3 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm text-center",children:"Refresh"})]})]})]})]})]})]})};export{W as default};
//# sourceMappingURL=AdminDashboard-f3f24ef6.js.map
