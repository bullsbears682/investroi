import{q as l,j as e}from"./index-7f6277d0.js";import{r as a}from"./vendor-fb33f09a.js";import{A as F}from"./AdminMenu-36ba4759.js";import{a as O}from"./router-c6dabb7d.js";import{a9 as P,ac as x,r as U,X as k,a5 as q,b as C,n as B}from"./ui-99c97883.js";const J=()=>{const A=O(),[f,M]=a.useState(!1),[r,T]=a.useState([]),[s,o]=a.useState(null),[v,d]=a.useState([]),[h,j]=a.useState(""),[i,m]=a.useState("waiting"),[u,g]=a.useState(!1);a.useEffect(()=>{n();const t=setInterval(n,5e3);return()=>clearInterval(t)},[]),a.useEffect(()=>{if(s){p(s.id);const t=setInterval(()=>p(s.id),3e3);return()=>clearInterval(t)}},[s]);const n=()=>{try{const t=l.getAllSessions();T(t)}catch(t){console.error("Failed to load chat sessions:",t)}},p=t=>{try{const c=l.getSessionMessages(t);d(c)}catch(c){console.error("Failed to load messages:",c)}},z=async t=>{g(!0);try{o(t),p(t.id),t.status==="waiting"&&(await l.assignSessionToAdmin(t.id,"admin-1","Admin"),setTimeout(()=>{n();const b=l.getAllSessions().find(R=>R.id===t.id);b&&o(b)},100))}catch(c){console.error("Error selecting session:",c)}finally{g(!1)}},N=async()=>{if(!(!h.trim()||!s)){g(!0);try{s.status==="waiting"&&await l.assignSessionToAdmin(s.id,"admin-1","Admin"),await l.sendMessage(s.id,"admin-1","Admin","admin@investwisepro.com",h.trim(),!0),j(""),p(s.id),n()}catch(t){console.error("Error sending message:",t)}finally{g(!1)}}},$=()=>{s&&(l.closeSession(s.id),o(null),d([]),n())},E=()=>{s&&(l.resolveSession(s.id),o(null),d([]),n())},D=()=>{s&&window.confirm(`Are you sure you want to delete ticket ${s.ticketNumber}? This action cannot be undone.`)&&(l.deleteSession(s.id),o(null),d([]),n())},I=()=>{const t=w();if(t.length===0)return;const c=i==="closed"?"closed":"resolved";window.confirm(`Are you sure you want to delete all ${c} tickets? This action cannot be undone.`)&&(t.forEach(b=>{l.deleteSession(b.id)}),o(null),d([]),n())},w=()=>{switch(i){case"waiting":return r.filter(t=>t.status==="waiting");case"active":return r.filter(t=>t.status==="active");case"closed":return r.filter(t=>t.status==="closed");case"resolved":return r.filter(t=>t.status==="resolved");default:return r}},y=t=>new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),S=t=>{switch(t){case"waiting":return"bg-yellow-500/20 text-yellow-400";case"active":return"bg-green-500/20 text-green-400";case"resolved":return"bg-purple-500/20 text-purple-400";case"closed":return"bg-gray-500/20 text-gray-400";default:return"bg-gray-500/20 text-gray-400"}},L=t=>{switch(t){case"waiting":return e.jsx(B,{size:16});case"active":return e.jsx(C,{size:16});case"resolved":return e.jsx(C,{size:16});case"closed":return e.jsx(k,{size:16});default:return e.jsx(x,{size:16})}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:[e.jsx(F,{isOpen:f,onToggle:()=>M(!f)}),e.jsx("div",{className:"bg-white/10 backdrop-blur-xl border-b border-white/20 lg:ml-64",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("button",{onClick:()=>A("/admin"),className:"flex items-center space-x-2 text-white/80 hover:text-white transition-colors",children:[e.jsx(P,{size:20}),e.jsx("span",{children:"Back to Dashboard"})]})}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center space-x-2",children:[e.jsx(x,{size:28}),e.jsx("span",{children:"Live Chat Management"})]})})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 lg:ml-64",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4 lg:gap-6 h-[calc(100vh-200px)]",children:[e.jsxs("div",{className:"xl:col-span-1 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 overflow-hidden",children:[e.jsxs("div",{className:"flex bg-white/5 border-b border-white/20 overflow-x-auto",children:[(i==="closed"||i==="resolved")&&w().length>0&&e.jsx("button",{onClick:I,className:"flex-shrink-0 px-3 py-2 text-xs font-medium bg-red-500/20 hover:bg-red-500/30 text-red-400 border-r border-white/20 transition-colors",title:`Delete all ${i} tickets`,children:"Delete All"}),e.jsxs("button",{onClick:()=>m("waiting"),className:`flex-shrink-0 px-3 lg:px-4 py-2 lg:py-3 text-xs lg:text-sm font-medium transition-colors whitespace-nowrap ${i==="waiting"?"bg-white/10 text-white border-b-2 border-blue-400":"text-white/60 hover:text-white"}`,children:["Waiting (",r.filter(t=>t.status==="waiting").length,")"]}),e.jsxs("button",{onClick:()=>m("active"),className:`flex-shrink-0 px-3 lg:px-4 py-2 lg:py-3 text-xs lg:text-sm font-medium transition-colors whitespace-nowrap ${i==="active"?"bg-white/10 text-white border-b-2 border-green-400":"text-white/60 hover:text-white"}`,children:["Active (",r.filter(t=>t.status==="active").length,")"]}),e.jsxs("button",{onClick:()=>m("resolved"),className:`flex-shrink-0 px-3 lg:px-4 py-2 lg:py-3 text-xs lg:text-sm font-medium transition-colors whitespace-nowrap ${i==="resolved"?"bg-white/10 text-white border-b-2 border-purple-400":"text-white/60 hover:text-white"}`,children:["Resolved (",r.filter(t=>t.status==="resolved").length,")"]}),e.jsxs("button",{onClick:()=>m("closed"),className:`flex-shrink-0 px-3 lg:px-4 py-2 lg:py-3 text-xs lg:text-sm font-medium transition-colors whitespace-nowrap ${i==="closed"?"bg-white/10 text-white border-b-2 border-gray-400":"text-white/60 hover:text-white"}`,children:["Closed (",r.filter(t=>t.status==="closed").length,")"]})]}),e.jsx("div",{className:"overflow-y-auto h-full",children:w().length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(x,{className:"mx-auto text-white/40 mb-4",size:32}),e.jsxs("p",{className:"text-white/60",children:["No ",i," sessions"]})]}):e.jsx("div",{className:"divide-y divide-white/10",children:w().map(t=>e.jsxs("div",{onClick:()=>z(t),className:`p-3 lg:p-4 cursor-pointer transition-colors hover:bg-white/5 ${(s==null?void 0:s.id)===t.id?"bg-white/10":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`p-1 rounded-full ${S(t.status)}`,children:L(t.status)}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:t.ticketNumber}),e.jsx("span",{className:"text-white/60 text-xs ml-2",children:t.userName})]})]}),e.jsx("span",{className:"text-xs text-white/60",children:y(t.lastActivity)})]}),e.jsx("p",{className:"text-sm text-white/70 truncate",children:t.lastMessage||"No messages yet"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("span",{className:"text-xs text-white/50",children:t.userEmail}),t.unreadCount>0&&e.jsx("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full",children:t.unreadCount})]})]},t.id))})})]}),e.jsx("div",{className:"xl:col-span-2 bg-white/10 backdrop-blur-xl rounded-2xl border border-white/20 overflow-hidden flex flex-col",children:s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-3 lg:p-4 border-b border-white/20 bg-white/5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2 lg:space-x-3 min-w-0 flex-1",children:[e.jsx("div",{className:"w-8 h-8 lg:w-10 lg:h-10 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(U,{className:"text-white",size:16})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("h3",{className:"font-semibold text-white text-sm lg:text-base truncate",children:[s.ticketNumber," - ",s.userName]}),e.jsx("p",{className:"text-xs lg:text-sm text-white/60 truncate",children:s.userEmail})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 lg:space-x-2 flex-shrink-0",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${S(s.status)}`,children:s.status}),s.status==="active"&&e.jsx("button",{onClick:E,className:"bg-green-500 hover:bg-green-600 text-white px-2 lg:px-3 py-1 rounded text-xs font-medium transition-colors",title:"Resolve Ticket",children:"Resolve"}),(s.status==="closed"||s.status==="resolved")&&e.jsx("button",{onClick:D,className:"bg-red-500 hover:bg-red-600 text-white px-2 lg:px-3 py-1 rounded text-xs font-medium transition-colors",title:"Delete Ticket",children:"Delete"}),e.jsx("button",{onClick:$,className:"p-1 lg:p-2 text-white/60 hover:text-white transition-colors",title:"Close Session",children:e.jsx(k,{size:14})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 min-h-0",children:v.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(x,{className:"mx-auto text-white/40 mb-4",size:32}),e.jsx("p",{className:"text-white/60",children:"No messages yet"}),e.jsx("p",{className:"text-white/40 text-sm",children:"Start the conversation"})]}):v.map(t=>e.jsx("div",{className:`flex ${t.isAdmin?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md p-3 rounded-lg ${t.isAdmin?"bg-blue-500/20 text-white":"bg-white/10 text-white"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium opacity-70",children:t.isAdmin?"Admin":s.userName}),e.jsx("span",{className:"text-xs opacity-60",children:y(t.timestamp)})]}),e.jsx("p",{className:"text-sm",children:t.message})]})},t.id))}),e.jsxs("div",{className:"p-3 lg:p-4 border-t border-white/20 bg-white/5",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:h,onChange:t=>j(t.target.value),onKeyPress:t=>t.key==="Enter"&&!u&&N(),placeholder:"Type your message...",disabled:u,className:"flex-1 bg-white/10 backdrop-blur-lg border border-white/20 rounded-lg px-2 lg:px-3 py-2 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 text-xs lg:text-sm disabled:opacity-50"}),e.jsx("button",{onClick:N,disabled:!h.trim()||u,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-500 disabled:cursor-not-allowed text-white p-2 rounded-lg transition-colors flex-shrink-0",children:e.jsx(q,{size:14})})]}),u&&e.jsx("div",{className:"mt-2 text-xs text-white/60",children:"Processing..."})]})]}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx(x,{className:"mx-auto text-white/40 mb-4",size:48}),e.jsx("h3",{className:"text-white font-medium mb-2",children:"Select a Chat Session"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Choose a session from the list to start chatting"})]})})})]})})]})};export{J as default};
//# sourceMappingURL=AdminChat-98f383b6.js.map
